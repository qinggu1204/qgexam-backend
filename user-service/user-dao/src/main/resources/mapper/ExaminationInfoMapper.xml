<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qgexam.user.dao.ExaminationInfoDao">

    <select id="getByExaminationId" resultType="com.qgexam.user.pojo.PO.ExaminationInfo">
        select *
        from examination_info
        where examination_id = #{examinationId}
          and is_deleted = 0
    </select>

    <insert id="insertExaminationInfo" useGeneratedKeys="true" keyProperty="examinationId" keyColumn="examination_id">
        insert into examination_info(examination_paper_id, examination_name, created_by, start_time, end_time,
                                     limit_time, is_question_resort, is_option_resort)
        values (#{examinationPaperId}, #{examinationName}, #{createdBy}, #{startTime}, #{endTime}, #{limitTime},
                #{isQuestionResort}, #{isOptionResort})
    </insert>

    <select id="getTeacherIdList" resultType="java.lang.Integer">
        select teacher_id
        from teacher_course
        where course_id in (select course_id
                            from course_examination
                            where examination_id = #{examinationId})
    </select>
    <select id="selectSubQuestionIdList" resultType="java.lang.Integer">
        select question_id
        from question_info
        where question_id in
              (select question_id
               from examination_paper_question
               where examination_paper_id = #{examinationPaperId})
          and sub_or_obj = 0;
    </select>

    <select id="selectAllExaminationInfo" resultType="com.qgexam.user.pojo.VO.ExaminationVO">
        select distinct ei.examination_id, ei.examination_name, ei.start_time, ei.end_time, ei.status
        from examination_info ei
        left join course_examination ce on ei.examination_id = ce.examination_id
        where
        ce.course_id in
        <foreach collection="courseIdList" item="courseId" open="(" separator="," close=")">
            #{courseId}
        </foreach>
        and ei.is_deleted = 0
        order by ei.status
    </select>
    <select id="isArranged" resultType="java.lang.Integer">
        select count(*)
        from teacher_invigilation
        where examination_id = #{examinationId}
          and is_deleted = 0
    </select>
</mapper>